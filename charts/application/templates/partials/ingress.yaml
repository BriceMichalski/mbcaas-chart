{{ define "mbcaas.ingress" }}
{{- $root := .root -}}
{{- $default := .default -}}
{{- $appName := .appName -}}
{{- $ing := .ingress -}}

apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: {{ printf "%s-ing" (include "mbcaas.fullname" (dict "appName" $appName)) }}
  labels:
    {{- include "mbcaas.labels" (dict "root" $root "appName" $appName) | nindent 4 }}
  {{- with $ing.annotations }}
  annotations:
    {{ . | toYaml | nindent 4}}
  {{- end }}

spec:
  rules:
    - host: {{ $ing.host | quote }}
      http:
        paths:
          {{- range $ing.paths }}
          {{- $path := . }}
          - path: {{ $path.path }}
            pathType: {{ $path.type }}
            backend:
              service:
                name: {{ printf "%s-svc" (include "mbcaas.fullname" (dict "appName" $appName)) }}
                port:
                  {{- if kindIs "string" $path.port }}
                  name: {{ $path.port }}
                  {{- else if kindIs "float64" $path.port }}
                  number: {{ $path.port }}
                  {{- end }}
          {{- end }}
{{ end }}
